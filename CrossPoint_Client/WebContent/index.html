<!DOCTYPE html>
<html>
	<head>
		<meta charset="ISO-8859-1">
		<title>CenterPoint</title>
   <style>
		body{
			background-color:#CCC;
        	padding-bottom: 20px;
		}
		#map-inner{
			height: 700px
		}
      	#map-outer{
      		height: 750px;
	  		padding: 20px; 
			border: 2px solid #CCC; 
			margin-bottom: 20px; 
			background-color:#FFF
		}
		#panel-inner{
			height: 700px;
			overflow-y: scroll;
		}
		#panel-outer{
      		height: 750px;
	  		padding: 20px; 
			border: 2px solid #CCC; 
			margin-bottom: 20px; 
			background-color:#FFF
		}
		#floating-panel
		{
			position: absolute;
		  	top: 20px;
		  	/* left: 50%; */
		  	z-index: 5;
		  	background-color: #fff;
		  	padding: 5px;
		  	border: 1px solid #999;
		  	text-align: center;
		  	font-family: 'Roboto','sans-serif';
		  	line-height: 30px;
		  	padding-left: 10px;
		}
    </style>
    	<!-- Latest compiled and minified CSS for bootstrap -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" 
		integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<!-- Optional bootstrap theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" 
		integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
	</head>
	<body>
		<div id="header"></div>
		<div class="row">
			<div id="map-outer" class="col-md-8 col-md-offset-1">
			    <div id="floating-panel">
			      <input onclick="clearMarkers();" type=button value="Hide Markers">
			      <input onclick="showMarkers();" type=button value="Show All Markers">
			      <input onclick="deleteMarkers();" type=button value="Delete Markers">
			    </div>
	  			<div id="map-inner"></div>
	      	</div>
	      	<div class="col-md-2">
	      		<div id="panel-outer" class="row">
		      		<div id="panel-inner" class="panel panel-default">
						<div class="panel-heading" align="middle"><strong>Points on the Map</strong></div>
					</div>
				</div>
				<div align="center" class="row">
					<button type="button" class="btn btn-default btn-lg">Find the Center Point</button>
				</div>
	      	</div>
		</div>
		<div id="footer"></div>
	</body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script
		src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" 
		integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
		crossorigin="anonymous"><!-- Latest compiled and minified JavaScript -->
	</script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARilHXTyOd50Ad_ZhZtcSljCKyRC2QxoQ&signed_in=false">
    </script>
	<script>
		$(function(){
			$("#header").load("header.html");
			$("#footer").load("footer.html");
			initMap();
		});
		
		function closePanel(){
			alert("close: ");
		    $(this).parent().fadeOut();
		}
		
		var map;
		var markers = [];
		var initialLocation;
		var siberia = new google.maps.LatLng(60, 105);
		var newyork = new google.maps.LatLng(40.69847032728747, -73.9514422416687);
		var browserSupportFlag =  new Boolean();
		
		function initMap()
		{
			map = new google.maps.Map(document.getElementById("map-inner"),{
				zoom: 12,
			    mapTypeId: google.maps.MapTypeId.ROADMAP,
			    
			    mapTypeControl: true,
			    mapTypeControlOptions: {
			        style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
			        position: google.maps.ControlPosition.BOTTOM_CENTER
			    },
			    zoomControl: true,
			    zoomControlOptions: {
			        position: google.maps.ControlPosition.LEFT_CENTER
			    },
			    scaleControl: true,
			    streetViewControl: false,
			    draggableCursor : "url(http://s3.amazonaws.com/besport.com_images/status-pin.png)"
			});
			
			if(navigator.geolocation){
			 	browserSupportFlag = true;
			    navigator.geolocation.getCurrentPosition(function(position){
			    	initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
			    	map.setCenter(initialLocation);
			    	
			    	//Put a blue dot on your current location
			    	var marker = new google.maps.Marker({
	    				position: initialLocation,
	    				title: 'Your Current Location\n'+initialLocation,
	    				map: map,
	    				icon: {url:'img/currentLocation.svg', scaledSize: new google.maps.Size(20,20)}
	    			});
			    	
			    	//set the listener for each map click
					map.addListener('click', function( event ){
						//add marker to the map/array
						addMarker(event.latLng);
						
						//put marker info on sidebar
						var lat = event.latLng.lat();
						var lon = event.latLng.lng();
						document.getElementById('panel-inner').innerHTML += 
							'<div class="alert alert-default alert-dismissible" role="alert">'+
							'<button type="button" class="close" aria-hidden="true" onclick="closePanel()">&times;</button>'+
							'<p>Latitude: ' + lat + ', Longitude: ' + lon + '</p>'+
							'</div>'
					});
			    	
				//map.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push(myButton());
			    				    	
				}, function(){
					handleNoGeolocation(browserSupportFlag);
			    });
			} else { // Browser doesn't support Geolocation
				browserSupportFlag = false;
				handleNoGeolocation(browserSupportFlag);
			}
						
			function handleNoGeolocation(errorFlag){
				if (errorFlag == true){
					alert("Geolocation service failed.");
			      	initialLocation = newyork;
			    } else {
					alert("Your browser doesn't support geolocation. We've placed you in Siberia.");
			      	initialLocation = siberia;
			    }
			    map.setCenter(initialLocation);
			}
		}
		
		function addMarker(location){
			var lat = location.lat();
			var lon = location.lng();
		    var marker = new google.maps.Marker({
		        position: location,
		        title: 'Latitude: ' + lat + ', Longitude: ' + lon,
		        map: map,
//			        icon: {url:'img/redCrossPoint.svg', scaledSize: new google.maps.Size(20,20)}
		    });
		    markers.push(marker);
		}
		
		// Sets the map on all markers in the array.
		function setMapOnAll(map) {
		  for (var i = 0; i < markers.length; i++) {
		    markers[i].setMap(map);
		  }
		}

		// Removes the markers from the map, but keeps them in the array.
		function clearMarkers() {
		  setMapOnAll(null);
		}

		// Shows any markers currently in the array.
		function showMarkers() {
		  setMapOnAll(map);
		}

		// Deletes all markers in the array by removing references to them.
		function deleteMarkers() {
		  clearMarkers();
		  markers = [];
		}
    </script>
</html>